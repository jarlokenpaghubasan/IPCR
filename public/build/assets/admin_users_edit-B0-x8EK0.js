const r=document.getElementById("photoInput");document.getElementById("photoUploadForm");const i=document.getElementById("uploadProgress");document.getElementById("progressBar");const n=document.getElementById("uploadMessage"),c=document.getElementById("uploadText");window.toggleSidebar=function(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebarOverlay");e.classList.toggle("sidebar-hidden"),t.classList.toggle("hidden")};document.querySelectorAll("#sidebar a, #sidebar button").forEach(e=>{e.addEventListener("click",()=>{window.innerWidth<1024&&(document.getElementById("sidebar").classList.add("sidebar-hidden"),document.getElementById("sidebarOverlay").classList.add("hidden"))})});window.addEventListener("resize",()=>{const e=document.getElementById("sidebar"),t=document.getElementById("sidebarOverlay");window.innerWidth>=1024?(e.classList.remove("sidebar-hidden"),t.classList.add("hidden")):(e.classList.add("sidebar-hidden"),t.classList.add("hidden"))});window.addEventListener("load",()=>{const e=document.getElementById("sidebar");window.innerWidth<1024&&e.classList.add("sidebar-hidden")});r.addEventListener("change",function(){this.files.length>0&&(c.textContent=this.files[0].name,u(this.files[0]))});function u(e){const t=new FormData;t.append("photo",e),t.append("_token",document.querySelector('input[name="_token"]').value),i.classList.remove("hidden"),n.innerHTML="",fetch(`/admin/panel/users/${userId}/photo/upload`,{method:"POST",body:t}).then(o=>o.json()).then(o=>{i.classList.add("hidden"),o.success?(n.innerHTML='<span class="text-green-600 text-xs"><i class="fas fa-check-circle mr-1"></i>'+o.message+"</span>",r.value="",c.textContent="Choose Photo",a()):n.innerHTML='<span class="text-red-600 text-xs"><i class="fas fa-times-circle mr-1"></i>'+o.message+"</span>"}).catch(o=>{i.classList.add("hidden"),n.innerHTML='<span class="text-red-600 text-xs"><i class="fas fa-times-circle mr-1"></i>Upload failed</span>',console.error("Error:",o)})}function a(){fetch(`/admin/panel/users/${userId}/photos`).then(e=>e.json()).then(e=>{const t=document.getElementById("allPhotos"),o=document.getElementById("photoCount");if(o.textContent=e.photos.length,e.photos.length===0){t.innerHTML='<p class="text-gray-600 text-xs col-span-3">No photos yet</p>';return}t.innerHTML=e.photos.map(s=>`
                <div class="relative group">
                    <img src="${s.url}" alt="Photo" class="w-full aspect-square object-cover rounded-lg">
                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 rounded-lg transition flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100">
                        ${s.is_profile?"":`
                            <button onclick="setAsProfile(${s.id})" class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg text-xs transition" title="Set as profile">
                                <i class="fas fa-check"></i>
                            </button>
                        `}
                        <button onclick="deletePhoto(${s.id}, '${s.url}')" class="text-red-600 hover:text-red-900 bg-white p-2 rounded-lg transition" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    ${s.is_profile?'<span class="absolute top-1 right-1 bg-blue-500 text-white px-2 py-1 rounded text-xs font-semibold"><i class="fas fa-check"></i></span>':""}
                </div>
            `).join("")})}let d=null,l=null;window.setAsProfile=function(e){l=e,document.getElementById("setProfileModal").classList.remove("hidden")};window.closeSetProfileModal=function(){document.getElementById("setProfileModal").classList.add("hidden"),l=null};window.confirmSetProfile=function(){l&&fetch(`/admin/panel/users/${userId}/photos/${l}/set-profile`,{method:"PATCH",headers:{"X-CSRF-TOKEN":document.querySelector('input[name="_token"]').value,"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{closeSetProfileModal(),e.success?window.location.reload():alert(e.message||"Failed to set as profile")}).catch(e=>{closeSetProfileModal(),console.error("Error:",e),alert("Failed to set as profile")})};window.deletePhoto=function(e,t){d=e,document.getElementById("deletePhotoModal").classList.remove("hidden")};window.closeDeletePhotoModal=function(){document.getElementById("deletePhotoModal").classList.add("hidden"),d=null};window.confirmDeletePhoto=function(){d&&fetch(`/admin/panel/users/${userId}/photos/${d}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('input[name="_token"]').value,"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{closeDeletePhotoModal(),e.success?a():alert(e.message||"Failed to delete photo")}).catch(e=>{closeDeletePhotoModal(),console.error("Error:",e),alert("Failed to delete photo")})};a();
